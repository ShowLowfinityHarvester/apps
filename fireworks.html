<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <title>Fireworks Extravaganza</title>
    <style>
        body {
            margin: 0;
            background-color: #1a1a1a;
            overflow: hidden;
        }

        canvas#global-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <canvas id="global-canvas"></canvas>
    <script>
        const canvas = document.getElementById('global-canvas');
        const ctx = canvas.getContext('2d');
        let particlesArray = [];
        const numberOfParticles = 10;
        const maxParticles = 5000;
        let animationFrameId;
        let lastFrameTime = 0;
        const targetFPS = 60;
        const frameInterval = 1000 / targetFPS;
        let isPageVisible = true;
        let letterKeyMode = 'unique'; // 'unique' or 'letter'

        const colors = [
            'rgba(255, 99, 71, 0.8)',   // Red
            'rgba(74, 144, 226, 0.8)',  // Blue
            'rgba(60, 179, 113, 0.8)',  // Green
            'rgba(255, 215, 0, 0.8)',   // Yellow
            'rgba(147, 112, 219, 0.8)'  // Purple
        ];

        function blendColors(color1, color2, factor) {
            const parseRGBA = (color) => {
                const match = color.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/);
                return match ? {
                    r: parseInt(match[1]),
                    g: parseInt(match[2]),
                    b: parseInt(match[3]),
                    a: parseFloat(match[4])
                } : { r: 255, g: 255, b: 255, a: 0.8 };
            };

            const c1 = parseRGBA(color1);
            const c2 = parseRGBA(color2);

            const r = Math.round(c1.r + (c2.r - c1.r) * factor);
            const g = Math.round(c1.g + (c2.g - c1.g) * factor);
            const b = Math.round(c1.b + (c2.b - c1.b) * factor);
            const a = c1.a + (c2.a - c1.a) * factor;

            return `rgba(${r}, ${g}, ${b}, ${a})`;
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor(type = 'background', x = null, y = null, effectType = null, effectColor = null, target = null, direction = null, letter = null) {
                this.type = type;
                this.x = x !== null ? x : Math.random() * canvas.width;
                this.y = y !== null ? y : Math.random() * canvas.height;
                this.size = type === 'firework' ? 5 : (type === 'burst' || type === 'secondary' || type === 'tertiary' ? Math.random() * 5 + 3 : Math.random() * 4 + 2);
                if (type === 'secondary') this.size *= 0.5;
                if (type === 'tertiary') this.size *= 0.25;
                if (type === 'fused' || type === 'massive') this.size = 10;
                if (type === 'spark') this.size = 2;
                if (type === 'trail') this.size = 3;
                if (type === 'rain') this.size = 1.5;
                if (type === 'smoke') this.size = 4;
                if (type === 'laser') this.size = 2;
                if (type === 'comet') this.size = 4;
                if (type === 'fractal') this.size = 3; // Increased from 2 for visibility
                if (type === 'nebula') this.size = 6;
                if (type === 'zipper') this.size = 2;
                this.opacity = 1;
                this.effectType = effectType;
                this.effectColor = effectColor || colors[Math.floor(Math.random() * colors.length)];
                this.target = target;
                this.direction = direction;
                this.letter = letter;
                this.angle = Math.random() * Math.PI * 2;
                this.pulsePhase = Math.random() * Math.PI;
                this.shakePhase = Math.random() * Math.PI * 2;
                this.wavePhase = Math.random() * Math.PI;
                this.twinklePhase = Math.random() * Math.PI;
                this.bounceCount = type === 'bounce' ? 3 : 0;
                this.fractalDepth = type === 'fractal' ? 1 : 0; // Simplified to 1 for U key
                this.laserLength = type === 'laser' || type === 'zipper' ? 20 : (type === 'fractal' ? 30 : 0); // Increased for fractal
                this.delayTimer = type === 'fused' || type === 'massive' ? 30 : (type === 'wave' ? 60 : 20);
                this.fuseTransition = type === 'firework' && effectType === '2' ? 5 : 0;
                this.isMerging = false;
                this.waveRadius = type === 'wave' || type === 'pulse' ? 10 : 0;
                this.tailLength = type === 'trail' || type === 'comet' ? 10 : (type === 'zipper' ? 15 : 0);

                if (type === 'background') {
                    this.speedX = Math.random() * 0.5 - 0.25;
                    this.speedY = Math.random() * 0.5 - 0.25;
                    this.life = Infinity;
                    this.color = 'rgba(17, 255, 0, 0.5)';
                } else if (type === 'burst' || type === 'secondary' || type === 'tertiary') {
                    this.life = type === 'tertiary' ? 60 : (type === 'secondary' ? 50 : 50); // Increased secondary life
                    this.color = this.effectType === 'cascade' && type === 'secondary' ? 'rgba(255, 255, 255, 0.8)' : this.effectColor;
                    this.setExplosionSpeeds();
                } else if (type === 'firework' || type === 'massive') {
                    if (effectType === '2') {
                        if (this.direction === 'right') {
                            this.speedX = 4;
                            this.speedY = -5;
                        } else if (this.direction === 'left') {
                            this.speedX = -4;
                            this.speedY = -5;
                        }
                    } else {
                        this.speedX = 0;
                        this.speedY = -Math.random() * 5 - 5;
                    }
                    this.life = type === 'massive' ? 120 : 100;
                    this.color = 'rgba(255, 255, 255, 0.8)';
                    this.exploded = false;
                    this.effectColor = this.effectColor || colors[Math.floor(Math.random() * colors.length)];
                } else if (type === 'fused') {
                    this.speedX = 0;
                    this.speedY = 0;
                    this.life = 30;
                    this.color = this.effectColor;
                    this.exploded = false;
                } else if (type === 'spark') {
                    this.speedX = (Math.random() - 0.5) * 8;
                    this.speedY = (Math.random() - 0.5) * 8;
                    this.life = 40;
                    this.color = this.effectColor;
                } else if (type === 'trail') {
                    this.speedX = this.direction === 'left' ? -5 : (this.direction === 'right' ? 5 : 0);
                    this.speedY = this.direction === 'up' ? -5 : (this.direction === 'down' ? 5 : 0);
                    this.life = 50;
                    this.color = this.effectColor;
                    this.tailLength = 10;
                } else if (type === 'wave') {
                    this.speedX = 0;
                    this.speedY = 0;
                    this.life = 60;
                    this.color = this.effectColor;
                } else if (type === 'rain') {
                    this.speedX = (Math.random() - 0.5) * 2;
                    this.speedY = Math.random() * 3 + 2;
                    this.life = 80;
                    this.color = this.effectColor;
                } else if (type === 'bounce') {
                    this.speedX = (Math.random() - 0.5) * 6;
                    this.speedY = (Math.random() - 0.5) * 6;
                    this.life = 100;
                    this.color = this.effectColor;
                } else if (type === 'smoke') {
                    this.speedX = (Math.random() - 0.5) * 1;
                    this.speedY = (Math.random() - 0.5) * 1;
                    this.life = 50;
                    this.color = 'rgba(100, 100, 100, 0.5)';
                } else if (type === 'laser') {
                    this.speedX = Math.cos(this.angle) * 5;
                    this.speedY = Math.sin(this.angle) * 5;
                    this.life = 40;
                    this.color = this.effectColor;
                } else if (type === 'comet') {
                    this.speedX = Math.cos(this.angle) * 4;
                    this.speedY = Math.sin(this.angle) * 4;
                    this.life = 60;
                    this.color = this.effectColor;
                    this.tailLength = 15;
                } else if (type === 'fractal') {
                    this.speedX = Math.cos(this.angle) * 3;
                    this.speedY = Math.sin(this.angle) * 3;
                    this.life = 50;
                    this.color = this.effectColor;
                } else if (type === 'nebula') {
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 3;
                    this.life = 50;
                    this.color = this.effectColor;
                } else if (type === 'zipper') {
                    this.speedX = Math.cos(this.angle) * 4;
                    this.speedY = Math.sin(this.angle) * 4;
                    this.life = 40;
                    this.color = this.effectColor;
                }
            }

            setExplosionSpeeds() {
                const speed = Math.random() * 4 + 3;
                if (this.effectType === '0') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.5;
                    this.speedY = Math.sin(angle) * speed * 0.5;
                } else if (this.effectType === '2' || this.effectType === 'space') {
                    this.angle = (particlesArray.filter(p => (p.effectType === '2' || p.effectType === 'space') && p.type === 'burst').length % 16) * (Math.PI / 8);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === '3') {
                    this.angle = Math.random() * Math.PI * 2; // Initialize angle
                    this.speedX = Math.cos(this.angle) * speed * 0.5;
                    this.speedY = Math.sin(this.angle) * speed * 0.5;
                } else if (this.effectType === '4') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.2;
                    this.speedY = Math.sin(angle) * speed * 0.2;
                } else if (this.effectType === '5' || this.effectType === 'space') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.3;
                    this.speedY = Math.sin(angle) * speed * 0.3;
                    this.pulsePhase = Math.random() * Math.PI;
                } else if (this.effectType === '6') {
                    this.angle = (particlesArray.filter(p => p.effectType === '6' && p.type === 'burst').length % 16) * (Math.PI / 8);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === '7') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.3;
                    this.speedY = Math.sin(angle) * speed * 0.3;
                } else if (this.effectType === '8') {
                    const direction = Math.floor(Math.random() * 4);
                    if (direction === 0) {
                        this.speedX = 0;
                        this.speedY = -speed;
                    } else if (direction === 1) {
                        this.speedX = 0;
                        this.speedY = speed;
                    } else if (direction === 2) {
                        this.speedX = -speed;
                        this.speedY = 0;
                    } else {
                        this.speedX = speed;
                        this.speedY = 0;
                    }
                } else if (this.effectType === '9') {
                    this.speedX = (Math.random() - 0.5) * 2;
                    this.speedY = -speed * 1.5;
                } else if (this.effectType && this.effectType.startsWith('letter_')) {
                    const char = this.effectType.split('_')[1];
                    const offset = (particlesArray.filter(p => p.effectType === this.effectType && p.type === 'burst').length % 10) - 5;
                    this.speedX = offset * 2;
                    this.speedY = (Math.random() - 0.5) * 2;
                    this.letter = char;
                } else if (this.effectType === 'star') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'star' && p.type === 'burst').length % 5) * (2 * Math.PI / 5);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'heart') {
                    const t = (particlesArray.filter(p => p.effectType === 'heart' && p.type === 'burst').length % 16) * (Math.PI / 8);
                    this.speedX = 16 * Math.pow(Math.sin(t), 3) * 0.2;
                    this.speedY = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) * 0.2;
                } else if (this.effectType === 'wave') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.5;
                    this.speedY = Math.sin(this.angle) * speed * 0.5;
                    this.wavePhase = Math.random() * Math.PI;
                } else if (this.effectType === 'burst') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed;
                    this.speedY = Math.sin(angle) * speed;
                } else if (this.effectType === 'colorburst') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.5;
                    this.speedY = Math.sin(angle) * speed * 0.5;
                } else if (this.effectType === 'laserburst') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'laserburst' && p.type === 'laser').length % 12) * (Math.PI / 6);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'comet') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(this.angle) * speed * 0.8;
                    this.speedY = Math.sin(this.angle) * speed * 0.8;
                } else if (this.effectType === 'pulse') {
                    this.speedX = 0;
                    this.speedY = 0;
                } else if (this.effectType === 'fractal') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'fractal' && p.type === 'fractal').length % 8) * (Math.PI / 4);
                    this.speedX = Math.cos(this.angle) * speed * 0.5;
                    this.speedY = Math.sin(this.angle) * speed * 0.5;
                } else if (this.effectType === 'cascade') {
                    this.speedX = (Math.random() - 0.5) * 4;
                    this.speedY = (Math.random() - 0.5) * 4;
                } else if (this.effectType === 'supernova') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 1.5;
                    this.speedY = Math.sin(this.angle) * speed * 1.5;
                } else if (this.effectType === 'fireball') {
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 3;
                } else if (this.effectType === 'rain') {
                    this.speedX = (Math.random() - 0.5) * 2;
                    this.speedY = Math.random() * 3 + 2;
                } else if (this.effectType === 'bounce') {
                    this.speedX = (Math.random() - 0.5) * 6;
                    this.speedY = (Math.random() - 0.5) * 6;
                } else if (this.effectType === 'vortex') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(this.angle) * speed * 0.7;
                    this.speedY = Math.sin(this.angle) * speed * 0.7;
                } else if (this.effectType === 'nova') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 1.2;
                    this.speedY = Math.sin(this.angle) * speed * 1.2;
                } else if (this.effectType === 'prism') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'prism' && p.type === 'burst').length % 6) * (Math.PI / 3);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'meteor') {
                    this.speedX = (Math.random() - 0.5) * 5;
                    this.speedY = Math.random() * 3 + 2;
                } else if (this.effectType === 'arc') {
                    this.angle = Math.random() * Math.PI;
                    this.speedX = Math.cos(this.angle) * speed * 0.6;
                    this.speedY = Math.sin(this.angle) * speed * 0.6;
                } else if (this.effectType === 'flare') {
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 3;
                } else if (this.effectType === 'laserbeam') {
                    this.angle = Math.PI / 2; // Upward
                    this.speedX = 0;
                    this.speedY = -speed * 1.5;
                } else if (this.effectType === 'laserfan') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'laserfan' && p.type === 'laser').length % 10) * (Math.PI / 20) + Math.PI;
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'lasersweep') {
                    this.angle = 0; // Horizontal left
                    this.speedX = -speed * 1.5;
                    this.speedY = 0;
                } else if (this.effectType === 'lasergrid') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'lasergrid' && p.type === 'laser').length % 8) * (Math.PI / 4);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'nebula') {
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 3;
                } else if (this.effectType === 'zipper') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'zipper' && p.type === 'zipper').length % 2) * Math.PI / 2;
                    this.speedX = Math.cos(this.angle + Math.sin(this.wavePhase) * Math.PI / 4) * speed;
                    this.speedY = Math.sin(this.angle + Math.sin(this.wavePhase) * Math.PI / 4) * speed;
                    this.wavePhase = Math.random() * Math.PI;
                } else if (this.effectType === 'cross') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'cross' && p.type === 'burst').length % 4) * (Math.PI / 2);
                    this.speedX = Math.cos(this.angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                } else if (this.effectType === 'fountain') {
                    this.speedX = (Math.random() - 0.5) * 2;
                    this.speedY = -speed * 1.5;
                } else if (this.effectType === 'cluster') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.4;
                    this.speedY = Math.sin(this.angle) * speed * 0.4;
                } else if (this.effectType === 'swirl') {
                    this.angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(this.angle) * speed * 0.6;
                    this.speedY = Math.sin(this.angle) * speed * 0.6;
                } else if (this.effectType === 'bloom') {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed * 0.8;
                    this.speedY = Math.sin(this.angle) * speed * 0.8;
                } else if (this.effectType === 'phoenix') {
                    this.speedX = (Math.random() - 0.5) * 4;
                    this.speedY = (Math.random() - 0.5) * 4;
                } else if (this.effectType === 'galaxy') {
                    this.angle = (particlesArray.filter(p => p.effectType === 'galaxy' && p.type === 'burst').length % 8) * (Math.PI / 4);
                    this.speedX = Math.cos(this.angle) * speed * 0.7;
                    this.speedY = Math.sin(this.angle) * speed * 0.7;
                } else if (this.effectType === 'sparkler') {
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 3;
                } else {
                    const angle = Math.random() * Math.PI * 2;
                    this.speedX = Math.cos(angle) * speed;
                    this.speedY = Math.sin(this.angle) * speed;
                }
            }

            update() {
                if (this.type !== 'background') {
                    this.life--;
                }

                if (this.type === 'burst' || this.type === 'secondary' || this.type === 'tertiary') {
                    this.opacity = Math.max(0, this.life / (this.type === 'tertiary' ? 60 : (this.type === 'secondary' ? 50 : 50)));
                    if (this.opacity <= 0) return false;
                }

                if (this.type === 'firework' && !this.exploded) {
                    this.speedY += 0.05;
                    if (this.effectType === '2' && this.target && !this.isMerging) {
                        const dx = this.target.x - this.x;
                        const dy = this.target.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        const touchDistance = this.size + this.target.size;
                        if (distance < touchDistance) {
                            this.isMerging = true;
                            this.target.isMerging = true;
                            this.fuseTransition = 5;
                        } else if (distance < 100 && distance > 0) {
                            const G = 5;
                            const force = G / (distance * distance + 1);
                            const forceX = (dx / distance) * force;
                            const forceY = (dy / distance) * force;
                            this.speedX += forceX;
                            this.target.speedX -= forceX;
                            this.speedY += forceY;
                            this.target.speedY -= forceY;
                        }
                    } else if (this.life <= 20) {
                        this.exploded = true;
                        let numBurstParticles = this.effectType === '1' ? 30 : (this.effectType === '7' ? 8 : 16);
                        if (this.effectType && this.effectType.startsWith('letter_')) numBurstParticles = 10;
                        if (this.effectType === 'star' || this.effectType === 'heart') numBurstParticles = 20;
                        if (['!', '$'].includes(this.effectType)) numBurstParticles = 20;
                        if (this.effectType === 'rain') numBurstParticles = 30;
                        if (this.effectType === 'cascade') numBurstParticles = 10;
                        if (this.effectType === 'supernova') numBurstParticles = 50;
                        if (this.effectType === 'laserburst' || this.effectType === 'prism') numBurstParticles = 12;
                        if (this.effectType === 'comet' || this.effectType === 'vortex' || this.effectType === 'arc') numBurstParticles = 20;
                        if (this.effectType === 'pulse' || this.effectType === 'nova') numBurstParticles = 15;
                        if (this.effectType === 'fractal') numBurstParticles = 12; // Increased from 8
                        if (this.effectType === 'meteor' || this.effectType === 'flare') numBurstParticles = 25;
                        if (this.effectType === 'laserbeam' || this.effectType === 'laserfan' || this.effectType === 'lasersweep' || this.effectType === 'lasergrid') numBurstParticles = 10;
                        if (this.effectType === 'nebula') numBurstParticles = 20;
                        if (this.effectType === 'zipper') numBurstParticles = 12;
                        if (this.effectType === 'cluster' || this.effectType === 'swirl' || this.effectType === 'bloom') numBurstParticles = 15;
                        if (this.effectType === 'phoenix' || this.effectType === 'galaxy') numBurstParticles = 20;
                        if (this.effectType === 'sparkler') numBurstParticles = 25;
                        for (let i = 0; i < numBurstParticles; i++) {
                            if (particlesArray.length >= maxParticles) break;
                            const particleType = ['!', '$'].includes(this.effectType) ? 'spark' : 
                                                this.effectType === 'rain' ? 'rain' : 
                                                this.effectType === 'cascade' ? 'secondary' : 
                                                this.effectType === 'fireball' ? (i < 15 ? 'burst' : 'smoke') : 
                                                this.effectType === 'supernova' ? (i < 40 ? 'burst' : 'spark') : 
                                                this.effectType === 'laserburst' ? 'laser' : 
                                                this.effectType === 'comet' ? 'comet' : 
                                                this.effectType === 'fractal' ? 'secondary' : // Secondary for multi-step
                                                this.effectType === 'laserbeam' ? 'laser' : 
                                                this.effectType === 'laserfan' ? 'laser' : 
                                                this.effectType === 'lasersweep' ? 'laser' : 
                                                this.effectType === 'lasergrid' ? 'laser' : 
                                                this.effectType === 'nebula' ? (i < 15 ? 'nebula' : 'spark') : 
                                                this.effectType === 'zipper' ? 'zipper' : 
                                                this.effectType === 'sparkler' ? 'spark' : 'burst';
                            const explosionParticle = new Particle(particleType, this.x, this.y, this.effectType, this.effectColor, null, this.direction, this.letter);
                            particlesArray.push(explosionParticle);
                        }
                        if (this.effectType === '@') {
                            if (particlesArray.length < maxParticles) {
                                particlesArray.push(new Particle('wave', this.x, this.y, 'wave', this.effectColor));
                                for (let i = 0; i < 3; i++) {
                                    if (particlesArray.length >= maxParticles) break;
                                    particlesArray.push(new Particle('wave', this.x + (Math.random() - 0.5) * 20, this.y + (Math.random() - 0.5) * 20, 'wave', this.effectColor));
                                }
                            }
                        }
                        if (this.effectType === 'supernova') {
                            if (particlesArray.length < maxParticles) {
                                particlesArray.push(new Particle('fused', this.x, this.y, 'supernova', this.effectColor));
                            }
                        }
                        return false;
                    }
                }

                if (this.type === 'massive' && !this.exploded) {
                    this.speedY += 0.05;
                    if (this.life <= 20) {
                        this.exploded = true;
                        const numBurstParticles = 100;
                        for (let i = 0; i < numBurstParticles; i++) {
                            if (particlesArray.length >= maxParticles) break;
                            const particleType = i < 80 ? 'burst' : (i < 90 ? 'spark' : 'wave');
                            const explosionParticle = new Particle(particleType, this.x, this.y, 'space', this.effectColor);
                            particlesArray.push(explosionParticle);
                        }
                        return false;
                    }
                }

                if (this.type === 'fused' && !this.exploded) {
                    const growthProgress = (30 - this.life) / 30;
                    this.size = 10 + 15 * (1 - Math.exp(-3 * growthProgress));
                    this.shakePhase += 0.3;
                    const shakeAmplitude = 2 * (this.life / 30);
                    this.x += Math.sin(this.shakePhase) * shakeAmplitude;
                    this.y += Math.cos(this.shakePhase) * shakeAmplitude;
                    if (this.life <= 5) {
                        this.exploded = true;
                        const numBurstParticles = 16;
                        for (let i = 0; i < numBurstParticles; i++) {
                            if (particlesArray.length >= maxParticles) break;
                            const explosionParticle = new Particle('burst', this.x, this.y, '2', this.effectColor);
                            particlesArray.push(explosionParticle);
                        }
                        return false;
                    }
                }

                if (this.type === 'burst') {
                    if (this.effectType === '0' && this.life <= 30) {
                        for (let i = 0; i < 3; i++) {
                            if (particlesArray.length >= maxParticles) break;
                            const secondaryParticle = new Particle('secondary', this.x, this.y, this.effectType, this.effectColor);
                            secondaryParticle.speedX = this.speedX + (Math.random() - 0.5) * 2;
                            secondaryParticle.speedY = this.speedY + (Math.random() - 0.5) * 2;
                            particlesArray.push(secondaryParticle);
                        }
                    } else if (this.effectType === '3') {
                        this.angle += 0.1;
                        this.speedX = Math.cos(this.angle) * 3;
                        this.speedY = Math.sin(this.angle) * 3;
                    } else if (this.effectType === '4') {
                        this.speedX *= 1.05;
                        this.speedY *= 1.05;
                    } else if (this.effectType === '5') {
                        this.pulsePhase += 0.2;
                        this.size = (Math.random() * 5 + 3) * (1 + 0.3 * Math.sin(this.pulsePhase));
                    } else if (this.effectType === '2' || this.effectType === '6') {
                        const expandSpeed = 1.05;
                        this.speedX *= expandSpeed;
                        this.speedY *= expandSpeed;
                    } else if (this.effectType === '7') {
                        this.delayTimer--;
                        if (this.delayTimer <= 0) {
                            for (let i = 0; i < 16; i++) {
                                if (particlesArray.length >= maxParticles) break;
                                const explosionParticle = new Particle('burst', this.x, this.y, this.effectType, this.effectColor);
                                particlesArray.push(explosionParticle);
                            }
                            this.delayTimer = Infinity;
                        }
                    } else if (this.effectType === '9') {
                        this.speedY += 0.1;
                    } else if (this.effectType === 'wave') {
                        this.wavePhase += 0.1;
                        this.speedX += Math.cos(this.wavePhase) * 0.5;
                        this.speedY += Math.sin(this.wavePhase) * 0.5;
                    } else if (this.effectType === 'vortex') {
                        this.angle += 0.2;
                        this.speedX = Math.cos(this.angle) * (this.life / 50) * 4;
                        this.speedY = Math.sin(this.angle) * (this.life / 50) * 4;
                    } else if (this.effectType === 'arc') {
                        this.angle += 0.1;
                        this.speedX = Math.cos(this.angle) * 3;
                        this.speedY = Math.sin(this.angle) * 3;
                    } else if (this.effectType === 'swirl') {
                        this.angle += 0.15;
                        this.speedX = Math.cos(this.angle) * (this.life / 50) * 3;
                        this.speedY = Math.sin(this.angle) * (this.life / 50) * 3;
                    }
                    this.speedY += 0.05;
                }

                if (this.type === 'secondary' && this.effectType === '0' && this.life <= 20) {
                    for (let i = 0; i < 2; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const tertiaryParticle = new Particle('tertiary', this.x, this.y, this.effectType, this.effectColor);
                        tertiaryParticle.speedX = this.speedX + (Math.random() - 0.5) * 1.5;
                        tertiaryParticle.speedY = this.speedY + (Math.random() - 0.5) * 1.5;
                        particlesArray.push(tertiaryParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'cascade' && this.life <= 20) {
                    const subEffects = ['burst', 'star', 'wave', 'heart'];
                    const subEffect = subEffects[Math.floor(Math.random() * subEffects.length)];
                    for (let i = 0; i < 5; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const burstParticle = new Particle('burst', this.x, this.y, subEffect, this.effectColor);
                        burstParticle.speedX = this.speedX + (Math.random() - 0.5) * 2;
                        burstParticle.speedY = this.speedY + (Math.random() - 0.5) * 2;
                        particlesArray.push(burstParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'laserburst' && this.life <= 20) {
                    for (let i = 0; i < 6; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const laserParticle = new Particle('laser', this.x, this.y, 'laserburst', this.effectColor);
                        laserParticle.angle = (i * Math.PI / 3) + Math.random() * 0.2;
                        particlesArray.push(laserParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'pulse' && this.life <= 20) {
                    for (let i = 0; i < 3; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const waveParticle = new Particle('wave', this.x, this.y, 'wave', this.effectColor);
                        waveParticle.speedX = (Math.random() - 0.5) * 1;
                        waveParticle.speedY = (Math.random() - 0.5) * 1;
                        particlesArray.push(waveParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'fractal' && this.life <= 20) {
                    for (let i = 0; i < 6; i++) { // Increased from 4 to 6
                        if (particlesArray.length >= maxParticles) break;
                        const fractalParticle = new Particle('fractal', this.x, this.y, 'fractal', this.effectColor);
                        fractalParticle.angle = (i * Math.PI / 3) + Math.random() * 0.3; // Wider spread
                        fractalParticle.fractalDepth = 1;
                        particlesArray.push(fractalParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'comet' && this.life <= 20) {
                    for (let i = 0; i < 5; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const cometParticle = new Particle('comet', this.x, this.y, 'comet', this.effectColor);
                        cometParticle.angle = (i * 2 * Math.PI / 5) + Math.random() * 0.2;
                        particlesArray.push(cometParticle);
                    }
                }

                if (this.type === 'secondary' && this.effectType === 'sparkler' && this.life <= 20) {
                    for (let i = 0; i < 8; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const sparkParticle = new Particle('spark', this.x, this.y, '!', this.effectColor);
                        sparkParticle.speedX = (Math.random() - 0.5) * 6;
                        sparkParticle.speedY = (Math.random() - 0.5) * 6;
                        particlesArray.push(sparkParticle);
                    }
                }

                if (this.type === 'secondary' || this.type === 'tertiary') {
                    this.speedY += 0.05;
                }

                if (this.type === 'spark' && this.effectType === '!') {
                    this.twinklePhase += 0.3;
                    this.size = 2 * (1 + 0.5 * Math.sin(this.twinklePhase));
                    this.opacity = this.life / 40;
                    if (this.life <= 0) return false;
                } else if (this.type === 'spark') {
                    this.opacity = this.life / 40;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'trail') {
                    this.opacity = this.life / 50;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'wave' || this.type === 'pulse') {
                    this.waveRadius += 2;
                    this.opacity = this.life / 60;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'rain') {
                    this.speedY += 0.1;
                    this.opacity = this.life / 80;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'bounce') {
                    if (this.x < this.size || this.x > canvas.width - this.size) {
                        this.speedX *= -0.8;
                        this.bounceCount--;
                        this.x = Math.max(this.size, Math.min(canvas.width - this.size, this.x));
                    }
                    if (this.y < this.size || this.y > canvas.height - this.size) {
                        this.speedY *= -0.8;
                        this.bounceCount--;
                        this.y = Math.max(this.size, Math.min(canvas.height - this.size, this.y));
                    }
                    this.opacity = this.life / 100;
                    if (this.life <= 0 || this.bounceCount <= 0) return false;
                }

                if (this.type === 'smoke') {
                    this.size += 0.2;
                    this.opacity = this.life / 50;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'laser' || this.type === 'zipper') {
                    this.wavePhase += 0.2;
                    if (this.effectType === 'zipper') {
                        this.angle += Math.sin(this.wavePhase) * 0.3;
                        this.speedX = Math.cos(this.angle) * 4;
                        this.speedY = Math.sin(this.angle) * 4;
                    }
                    this.opacity = this.life / 40;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'comet') {
                    this.opacity = this.life / 60;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'fractal' && this.life <= 30 && this.fractalDepth >= 1) {
                    for (let i = 0; i < 4; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const fractalParticle = new Particle('fractal', this.x, this.y, 'fractal', this.effectColor);
                        fractalParticle.angle = this.angle + (i * Math.PI / 2) + Math.random() * 0.2;
                        fractalParticle.fractalDepth = this.fractalDepth - 1;
                        fractalParticle.speedX = Math.cos(fractalParticle.angle) * 2;
                        fractalParticle.speedY = Math.sin(fractalParticle.angle) * 2;
                        particlesArray.push(fractalParticle);
                    }
                }

                if (this.type === 'fractal') {
                    this.opacity = this.life / 50;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'nebula') {
                    this.size += 0.1;
                    this.opacity = this.life / 50;
                    if (this.life <= 0) return false;
                }

                if (this.type === 'burst' && this.effectType === 'pulse') {
                    this.waveRadius += 1;
                    this.size = 10 * (1 + 0.5 * Math.sin(this.wavePhase));
                    this.wavePhase += 0.2;
                }

                this.x += this.speedX;
                this.y += this.speedY;

                if (this.type === 'background') {
                    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                }

                return !(this.x < -this.size || this.x > canvas.width + this.size || 
                         this.y < -this.size || this.y > canvas.height + this.size);
            }

            draw() {
                ctx.globalAlpha = this.opacity;
                if (this.type === 'burst' && this.letter) {
                    ctx.font = '20px Roboto';
                    ctx.fillStyle = this.color;
                    ctx.fillText(this.letter, this.x, this.y);
                } else if (this.type === 'wave' || this.type === 'pulse') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.waveRadius, 0, Math.PI * 2);
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                } else if (this.type === 'trail' || this.type === 'comet') {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    const tailX = this.x - this.speedX * this.tailLength;
                    const tailY = this.y - this.speedY * this.tailLength;
                    ctx.lineTo(tailX, tailY);
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = this.size;
                    ctx.stroke();
                } else if (this.type === 'rain') {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x, this.y + 10);
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = this.size;
                    ctx.stroke();
                } else if (this.type === 'laser' || this.type === 'fractal' || this.type === 'zipper') {
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    const endX = this.x + Math.cos(this.angle) * this.laserLength;
                    const endY = this.y + Math.sin(this.angle) * this.laserLength;
                    ctx.lineTo(endX, endY);
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = this.size;
                    ctx.stroke();
                } else {
                    if ((this.type === 'fused' || this.type === 'massive') && !this.exploded) {
                        const glowSize = this.size * 3;
                        const glowOpacity = (this.life / (this.type === 'massive' ? 120 : 30)) * 0.5;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, glowSize, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 255, 255, ${glowOpacity})`;
                        ctx.fill();
                    }
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
            }
        }

        let mouse = { x: null, y: null };

        document.addEventListener('mousemove', (event) => {
            mouse.x = event.clientX;
            mouse.y = event.clientY;
        });

        document.addEventListener('click', (event) => {
            if (particlesArray.length < maxParticles) {
                particlesArray.push(new Particle('firework', event.clientX, event.clientY, 'burst'));
            }
        });

        document.addEventListener('keydown', (event) => {
            if (particlesArray.length >= maxParticles) return;
            const key = event.key ? event.key.toLowerCase() : '';
            const keyCode = event.keyCode;
            const bottomY = canvas.height;
            const isShift = event.shiftKey;

            if (key === 'shift') {
                letterKeyMode = letterKeyMode === 'unique' ? 'letter' : 'unique';
                return;
            }

            if (keyCode >= 48 && keyCode <= 57) {
                const number = String.fromCharCode(keyCode);
                if (keyCode === 49) {
                    for (let i = 0; i < 5; i++) {
                        if (particlesArray.length >= maxParticles) break;
                        const randomX = Math.random() * canvas.width;
                        particlesArray.push(new Particle('firework', randomX, bottomY, '1'));
                    }
                } else if (keyCode === 50) {
                    const randomX1 = canvas.width * 0.25;
                    const randomX2 = canvas.width * 0.75;
                    const firework1 = new Particle('firework', randomX1, bottomY, '2', null, null, 'right');
                    const firework2 = new Particle('firework', randomX2, bottomY, '2', null, null, 'left');
                    firework1.target = firework2;
                    firework2.target = firework1;
                    firework1.effectColor = firework2.effectColor;
                    particlesArray.push(firework1);
                    particlesArray.push(firework2);
                } else {
                    const randomX = Math.random() * canvas.width;
                    particlesArray.push(new Particle('firework', randomX, bottomY, number));
                }
                return;
            }

            if (key === 'escape') {
                particlesArray = particlesArray.filter(p => p.type === 'background');
                return;
            }
            if (key === 'backspace') {
                if (particlesArray.length > numberOfParticles) {
                    particlesArray.pop();
                }
                return;
            }
            if (key === 'tab') {
                for (let i = 0; i < 10; i++) {
                    if (particlesArray.length >= maxParticles) break;
                    const x = canvas.width * (i / 10);
                    particlesArray.push(new Particle('firework', x, bottomY, 'burst'));
                }
                return;
            }

            if (key === ' ') {
                for (let i = 0; i < 3; i++) {
                    if (particlesArray.length >= maxParticles) break;
                    const randomX = Math.random() * canvas.width;
                    particlesArray.push(new Particle('massive', randomX, bottomY, 'space'));
                }
                return;
            }

            let effectType;
            let numFireworks = 3;
            if (/^[a-z]$/.test(key) && letterKeyMode === 'letter') {
                effectType = `letter_${key.toUpperCase()}`;
                numFireworks = 3;
            } else {
                switch (key) {
                    case 'a':
                        effectType = 'laserburst'; // Balls to lasers
                        numFireworks = 2;
                        break;
                    case 'b':
                        effectType = 'comet'; // Comet with glowing tail
                        numFireworks = 3;
                        break;
                    case 'c':
                        effectType = 'cascade'; // White balls to random fireworks
                        numFireworks = 2;
                        break;
                    case 'd':
                        effectType = 'sparkler'; // Balls to glitter
                        numFireworks = 2;
                        break;
                    case 'e':
                        effectType = 'nebula'; // Cloud-like burst with sparks
                        numFireworks = 3;
                        break;
                    case 'f':
                        effectType = 'fireball'; // Fiery burst with smoke
                        numFireworks = 3;
                        break;
                    case 'g':
                        effectType = 'vortex'; // Swirling spiral
                        numFireworks = 3;
                        break;
                    case 'h':
                        effectType = 'nova'; // Bright, expanding burst
                        numFireworks = 2;
                        break;
                    case 'i':
                        effectType = 'pulse'; // Balls to waves
                        numFireworks = 2;
                        break;
                    case 'j':
                        effectType = 'meteor'; // Falling meteor with trail
                        numFireworks = 3;
                        break;
                    case 'k':
                        effectType = 'prism'; // Hexagonal color burst
                        numFireworks = 2;
                        break;
                    case 'l':
                        effectType = 'arc'; // Curved particle arcs
                        numFireworks = 3;
                        break;
                    case 'm':
                        effectType = 'comet'; // Balls to comets
                        numFireworks = 2;
                        break;
                    case 'n':
                        effectType = 'burst'; // Standard burst
                        numFireworks = 3;
                        break;
                    case 'o':
                        effectType = 'wave'; // Expanding wave
                        numFireworks = 2;
                        break;
                    case 'p':
                        effectType = 'star'; // Star-shaped burst
                        numFireworks = 2;
                        break;
                    case 'q':
                        effectType = 'heart'; // Heart-shaped burst
                        numFireworks = 2;
                        break;
                    case 'r':
                        effectType = 'rain'; // Rain shower
                        numFireworks = 3;
                        break;
                    case 's':
                        effectType = 'supernova'; // Massive explosion with core
                        numFireworks = 2;
                        break;
                    case 't':
                        effectType = 'cross'; // Cross-shaped burst
                        numFireworks = 2;
                        break;
                    case 'u':
                        effectType = 'fractal'; // Balls to fractals
                        numFireworks = 2;
                        break;
                    case 'v':
                        effectType = 'fountain'; // Upward fountain
                        numFireworks = 3;
                        break;
                    case 'w':
                        effectType = 'cluster'; // Tight particle cluster
                        numFireworks = 3;
                        break;
                    case 'x':
                        effectType = 'swirl'; // Tight swirling burst
                        numFireworks = 3;
                        break;
                    case 'y':
                        effectType = 'bloom'; // Flower-like burst
                        numFireworks = 2;
                        break;
                    case 'z':
                        effectType = 'zipper'; // Zigzag laser pattern
                        numFireworks = 3;
                        break;
                    case 'arrowup':
                        effectType = 'laserbeam'; // Vertical laser beam
                        numFireworks = 2;
                        break;
                    case 'arrowdown':
                        effectType = 'laserfan'; // Downward laser fan
                        numFireworks = 2;
                        break;
                    case 'arrowleft':
                        effectType = 'lasersweep'; // Horizontal laser sweep
                        numFireworks = 2;
                        break;
                    case 'arrowright':
                        effectType = 'lasergrid'; // Laser crosshatch
                        numFireworks = 2;
                        break;
                    case '!':
                        effectType = '!'; // Twinkling sparks
                        break;
                    case '@':
                        effectType = '@'; // Wave with ripples
                        break;
                    case '#':
                        effectType = '6'; // Ring
                        break;
                    case '$':
                        effectType = '$'; // Twinkling sparks
                        break;
                    case '%':
                        effectType = 'wave';
                        break;
                    case '^':
                        effectType = '3'; // Spiral
                        break;
                    case '&':
                        effectType = '5'; // Pulsing
                        break;
                    case '*':
                        effectType = 'star';
                        break;
                    case '(':
                        effectType = 'heart';
                        break;
                    case ')':
                        effectType = 'heart';
                        break;
                    case '-':
                        effectType = '8'; // Cross
                        break;
                    case '=':
                        effectType = '6'; // Ring
                        break;
                    case '+':
                        effectType = '8'; // Cross
                        break;
                    case '[':
                        effectType = 'burst';
                        break;
                    case ']':
                        effectType = 'burst';
                        break;
                    case '{':
                        effectType = '3'; // Spiral
                        break;
                    case '}':
                        effectType = '3'; // Spiral
                        break;
                    case ';':
                        effectType = '9'; // Fountain
                        break;
                    case ':':
                        effectType = '9'; // Fountain
                        break;
                    case '\'':
                        effectType = 'star';
                        break;
                    case '"':
                        effectType = 'star';
                        break;
                    case ',':
                        effectType = 'wave';
                        break;
                    case '.':
                        effectType = 'burst';
                break;
                    case '/':
                        effectType = '8'; // Cross
                        break;
                    case '\\':
                        effectType = '8'; // Cross
                        break;
                    case '`':
                        effectType = 'star';
                        break;
                    case 'f1':
                    case 'f2':
                    case 'f3':
                    case 'f4':
                    case 'f5':
                    case 'f6':
                    case 'f7':
                    case 'f8':
                    case 'f9':
                    case 'f10':
                    case 'f11':
                    case 'f12':
                        effectType = 'colorburst';
                        numFireworks = parseInt(key.slice(1)) % 5 + 1;
                        break;
                    default:
                        effectType = 'burst';
                }
            }

            const colorIndex = typeof key === 'string' && key.startsWith('f') && key.length > 1 ? (parseInt(key.slice(1)) - 1) % colors.length : null;
            const effectColor = colorIndex !== null ? colors[colorIndex] : null;
            for (let i = 0; i < numFireworks; i++) {
                if (particlesArray.length >= maxParticles) break;
                const randomX = Math.random() * canvas.width;
                particlesArray.push(new Particle('firework', randomX, bottomY, effectType, effectColor, null, null, effectType.startsWith('letter_') ? key.toUpperCase() : null));
            }
        });

        document.addEventListener('mouseleave', () => {
            mouse.x = null;
            mouse.y = null;
        });

        function init() {
            particlesArray = [];
            for (let i = 0; i < numberOfParticles; i++) {
                if (particlesArray.length >= maxParticles) break;
                particlesArray.push(new Particle('background'));
            }
        }
        init();

        function animate(timestamp) {
            if (!isPageVisible) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            if (timestamp - lastFrameTime < frameInterval) {
                animationFrameId = requestAnimationFrame(animate);
                return;
            }
            lastFrameTime = timestamp;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const newParticlesArray = [];
            for (let i = 0; i < particlesArray.length; i++) {
                const particle = particlesArray[i];
                if (particle.update()) {
                    particle.draw();
                    newParticlesArray.push(particle);
                }
            }
            particlesArray = newParticlesArray;

            const hasBackgroundParticles = particlesArray.some(p => p.type === 'background');
            if (!hasBackgroundParticles && particlesArray.length === 0) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                return;
            }

            animationFrameId = requestAnimationFrame(animate);
        }

        if (particlesArray.length > 0) {
            lastFrameTime = performance.now();
            animationFrameId = requestAnimationFrame(animate);
        }

        document.addEventListener('visibilitychange', () => {
            isPageVisible = document.visibilityState === 'visible';
            if (isPageVisible && particlesArray.length > 0 && !animationFrameId) {
                lastFrameTime = performance.now();
                animationFrameId = requestAnimationFrame(animate);
            } else if (!isPageVisible && animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        });

        window.addEventListener('beforeunload', () => {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            particlesArray = [];
        });
    </script>
</body>
</html>